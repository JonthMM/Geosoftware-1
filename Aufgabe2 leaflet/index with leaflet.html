<!DOCTYPE html>
<html>

<head>
    <h1>Additional leaflet visualisation of the user position and the given point of interest</h1>
    <script async src="point.js"></script>
    <script async src="pois.js"></script>
    <script defer src="assignment2.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <div id="mapSection"></div>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div id="position">Click the button to get your coordinates</div>
    <button onclick="getLocation()">get position</button>
    <br></br>
    <textarea type="text" id="location"
        placeholder="Enter Point as geojson or click get position to use your position"></textarea>
    <div id="errorforinput"></div>
    <button type="button" class="button" onclick="textareaInputPoint()">Use geojson input from textarea</button>
    <br></br>
    <button type="button" class="button" onclick="standardPoint()">Use the given standard point</button>
    <div id="uploadInfo">Upload your own geojson that has the object type Point (no feature collection)</div>
    <input type="file" id="uploadbutton"><br>
    <div id="errorforupload"></div><br>
    <button type="button" class="button" onclick="uploadedPoint()">Use uploaded geojson</button>
    <br></br>
    <table id="table"></table>
    <script>
        var pois = {
            "type": "FeatureCollection",
            "features": [{
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Hauptbahnhof",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.634876,
                            51.957004
                        ]
                    },
                    "id": "1f1c1e76-de1e-4bf5-b927-0a0bdb59a10e"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Botanischer Garten",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.610287,
                            51.963638
                        ]
                    },
                    "id": "3145096c-2e80-469d-90ad-4f64afe56603"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Schlossplatz",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.616133,
                            51.963513
                        ]
                    },
                    "id": "3d09fee2-680b-4f23-b8c4-2550523b68ac"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Allwetterzoo Münster",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.587046,
                            51.94814
                        ]
                    },
                    "id": "b06930ab-076c-4d51-8443-9a3027865287"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Lambertikirche",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.628653,
                            51.962898
                        ]
                    },
                    "id": "74d44302-eab5-4547-9c93-90d5b8d2c0f9"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Institut für Geographie",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.595725,
                            51.969422
                        ]
                    },
                    "id": "29b749c4-b86e-47ba-ab1a-f39bb31e64ae"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Aasee",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.604563,
                            51.949979
                        ]
                    },
                    "id": "2a6069e1-d8d2-47e9-9a24-a126abd43f17"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Aaseekugeln",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.618322,
                            51.956997
                        ]
                    },
                    "id": "0e56c92d-a3ef-4386-b038-7782314f788e"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Prinzipalmarkt",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.628068,
                            51.962039
                        ]
                    },
                    "id": "8adf38a6-c8a6-4369-9806-d9512ff5ca6f"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Historisches Rathaus Münster",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.628025,
                            51.961701
                        ]
                    },
                    "id": "25b1bb91-2555-4970-9c05-e960e39e4aae"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Paulusdom",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.625337,
                            51.963017
                        ]
                    },
                    "id": "294c1ad7-017b-4964-92e0-1335cef6e9b6"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Mensa am Ring",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.600187,
                            51.965512
                        ]
                    },
                    "id": "f55d4b61-0b12-4286-b622-97cb3bdbdafc"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "LWL-Museum",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.624277,
                            51.961387
                        ]
                    },
                    "id": "a9672049-a000-47e8-85c5-9b14f55c6d81"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Mensa am Aasee",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.617179,
                            51.955609
                        ]
                    },
                    "id": "add64029-e251-41b1-9315-a55e9001754d"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Mensa Bispinghof",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.619486,
                            51.960323
                        ]
                    },
                    "id": "a54f9243-fabc-46cd-8d56-02365f1ffd12"
                },
                {
                    "type": "Feature",
                    "properties": {
                        "shape": "Marker",
                        "name": "Mensa Da Vinci",
                        "category": "default"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            7.601884,
                            51.97511
                        ]
                    },
                    "id": "50a849e1-315c-40a9-b7e2-84e9569b2730"
                }
            ]
        }
        // creating a map with OSM as basemap
        var map = L.map("mapSection").setView([51.965, 7.62], 14);
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Leaflet, OpenStreetMap Contributors',
        }).addTo(map);

        // creating layer with marker and popups out of the pois GeoJSON
        geojsonLayer = L.geoJson(pois, {
            pointToLayer: function (feature, latlng) {
                return new L.Marker(latlng, {});
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup("<b>" + feature.properties.name + "</b>" + "<br></br>" + "coordinates: " +
                    feature.geometry.coordinates);
            }
        });
        map.addLayer(geojsonLayer);

        // getting user position for the leaflet map
        if (!navigator.geolocation) {
            console.log("Your browser doesn't support geolocation feature!")
        } else {
            {
                navigator.geolocation.getCurrentPosition(getPosition)
            }
        }
        // marker for user position
        var marker;

        /** 
         * @function getPosition 
         * @desc function to get the location of the user
         * @param position is the user position
         */
        function getPosition(position) {
            // getting the latitude and longitude from the users position
            var lat = position.coords.latitude
            var long = position.coords.longitude

            // when there already is a marker, remove it to get the new user position
            if (marker) {
                map.removeLayer(marker)
            }
            // adding the user position to the map as a marker and binding a pop up with it to show the coordinates
            marker = L.marker([lat, long]).addTo(map)
            marker.bindPopup("Your position:" + "<br></br>" + long + ", " + lat);
        }
    </script>
</body>
</html>
